<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ‰‹å¹´åº¦æ€»ç»“ - SNAP Edition</title>
    <!-- å¼•å…¥åº“æ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;600;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Oswald:wght@500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // ä¿®æ”¹ï¼šæ›¿æ¢æ‰æ™®é²å£«è“ï¼Œæ”¹ä¸ºæ·±ç„¦ç³–/å’–å•¡è‰²
                        'vintage-brown': '#431407', // æ¥è¿‘é»‘è‰²çš„æ·±æ£•
                        'burnt-orange': '#9a3412',  // çƒ§æ©™è‰²
                        'classic-gold': '#d97706',
                        'warm-beige': '#e3dcd1', /* ç™½æ¿ä¸»è‰²è°ƒ */
                        'warm-beige-dark': '#d4cbbd',
                        'paper-white': '#fdfbf7',
                    },
                    fontFamily: {
                        'serif-sc': ['"Noto Serif SC"', 'serif'],
                        'playfair': ['"Playfair Display"', 'serif'],
                        'oswald': ['"Oswald"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f1f5f9;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* éšè—çš„æ¸²æŸ“åŒºåŸŸ (æš—æˆ¿) */
        #darkroom {
            position: fixed;
            left: -9999px;
            top: 0;
            pointer-events: none;
            opacity: 0; 
            z-index: -1;
        }

        /* æ‹ç«‹å¾—å¡ç‰‡å®¹å™¨ */
        #capture-target {
            padding: 40px; 
            background: transparent;
            width: 460px; 
            transform: translateZ(0);
        }

        /* æ‹ç«‹å¾—å¡ç‰‡æœ¬ä½“ */
        .polaroid-card {
            width: 380px;
            background-color: #fdfbf7;
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
            padding: 24px 24px 50px 24px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* é¡¶éƒ¨å¤§èƒ¶å¸¦ (è£…é¥°ç”¨ï¼Œæ¸²æŸ“æ—¶ä¼šéšè—) */
        .tape-main {
            position: absolute;
            top: -15px; 
            left: 50%;
            transform: translateX(-50%) rotate(-2deg);
            width: 140px;
            height: 35px;
            background-color: rgba(217, 119, 6, 0.4);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            z-index: 10;
            backdrop-filter: blur(2px);
            mask-image: linear-gradient(90deg, transparent 0%, black 2%, black 98%, transparent 100%);
            -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 2%, black 98%, transparent 100%);
        }

        /* ----------------------- 
           ç…§ç‰‡å¢™ä¸Šçš„å…ƒç´ æ ·å¼ 
           ----------------------- */
        .gallery-wrapper {
            position: relative;
            width: 260px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .gallery-wrapper:hover {
            transform: scale(1.1) rotate(0deg) !important;
            z-index: 100;
        }

        .gallery-wrapper:hover .download-btn-single {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .gallery-image {
            width: 100%;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15));
            display: block;
        }

        .gallery-wrapper:hover .gallery-image {
            filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3));
        }

        .tape-on-board {
            position: absolute;
            top: 15px; 
            left: 50%;
            transform: translateX(-50%) rotate(-1deg);
            width: 100px;
            height: 25px;
            background-color: rgba(217, 119, 6, 0.45); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            z-index: 20;
            backdrop-filter: blur(1px);
        }

        .download-btn-single {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            /* ä¿®æ”¹ï¼šå•å¼ ä¸‹è½½æŒ‰é’®èƒŒæ™¯è‰²ä¹Ÿæ”¹ä¸ºæ·±æ£•è‰²ç³» */
            background: rgba(67, 20, 7, 0.9);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
            z-index: 30;
            border: 2px solid rgba(255,255,255,0.4);
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .download-btn-single:hover {
            background: #d97706;
            border-color: white;
            transform: translate(-50%, -50%) scale(1);
        }

        .tape-gold {
            background-color: rgba(217, 119, 6, 0.5); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            backdrop-filter: blur(1px);
        }

        .paper-scrap {
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.03);
            position: relative;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }

        /* å·¦ä¾§è¾“å…¥åŒºèƒŒæ™¯ */
        .input-sidebar {
            background-color: #e3dcd1; /* ä¸ç™½æ¿ä¸€è‡´ */
        }

        /* çº¯å‡€ç™½æ¿èƒŒæ™¯ (å»æ‰äº†èŠ±çº¹) */
        .cork-board {
            background-color: #e3dcd1;
            /* background-image ç§»é™¤ï¼Œä¿æŒçº¯è‰² */
            border-left: 8px solid #854d0e; /* æœ¨è´¨è¾¹æ¡†åˆ†éš” */
            position: relative;
        }

        /* ç›¸æœºç»„ä»¶ */
        .camera-container {
            position: absolute;
            top: 40px; 
            left: 50%;
            transform: translateX(-50%);
            z-index: 50; 
            perspective: 1000px;
            pointer-events: none;
        }

        .camera-body {
            width: 200px;
            height: 150px;
            background: linear-gradient(to bottom, #fdfbf7 0%, #e8e6e1 100%);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3), inset 0 -4px 0 rgba(0,0,0,0.1);
            position: relative;
            z-index: 20; 
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: auto; 
        }
        
        .rainbow-stripe {
            position: absolute;
            bottom: 25px;
            width: 100%;
            height: 10px;
            /* ä¿®æ”¹ï¼šå½©è™¹æ¡ä¿ç•™å½©è‰²ï¼Œè¿™æ˜¯æ‹ç«‹å¾—çš„æ ‡å¿—ï¼Œæˆ–è€…æ‚¨å¯ä»¥è¦æ±‚ä¹Ÿæ”¹æˆæ©™è‰²ç³»ï¼Ÿè¿™é‡Œæš‚æ—¶ä¿ç•™æ ‡å¿—æ€§å½©è™¹ */
            background: linear-gradient(to right, #ff3b30 0%, #ff3b30 20%, #ff9500 20%, #ff9500 40%, #ffcc00 40%, #ffcc00 60%, #4cd964 60%, #4cd964 80%, #007aff 80%, #007aff 100%);
            opacity: 0.9;
        }

        .lens-outer {
            width: 90px;
            height: 90px;
            background: #222;
            border-radius: 50%;
            border: 4px solid #d1d1d6;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }

        .lens-inner {
            width: 65px;
            height: 65px;
            background: radial-gradient(circle at 30% 30%, #444 0%, #111 60%, #000 100%);
            border-radius: 50%;
            border: 2px solid #333;
            position: relative;
        }
        
        .lens-reflection {
            position: absolute;
            top: 15px; left: 15px; width: 15px; height: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .viewfinder {
            position: absolute; top: 15px; left: 15px; width: 30px; height: 25px;
            background: #333; border-radius: 6px; border: 2px solid #ccc;
        }

        .flash {
            position: absolute; top: 15px; right: 15px; width: 40px; height: 25px;
            background: #eee; border-radius: 4px; border: 2px solid #ccc;
            background-image: radial-gradient(circle, #fff 10%, #ddd 90%);
            transition: all 0.1s;
        }
        
        .flash.firing {
            box-shadow: 0 0 50px 30px rgba(255, 255, 255, 1);
            background: #fff;
        }

        .shutter-btn {
            position: absolute; bottom: -4px; right: 25px; width: 32px; height: 32px;
            background: #ff3b30; border-radius: 50%; border: 3px solid #d1d1d6;
            box-shadow: 0 3px 0 #b3261e;
            z-index: 3;
        }

        .slot {
            position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 160px; height: 10px;
            background: #111; border-radius: 0 0 10px 10px;
            z-index: 5;
        }

        .flying-photo {
            position: fixed; 
            width: 200px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transform-origin: top center;
            transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
        
        .placeholder-item {
            width: 260px;
            height: 340px; 
            background: rgba(0,0,0,0.05);
            border: 2px dashed rgba(0,0,0,0.1);
            border-radius: 4px;
            visibility: hidden;
        }

        /* -----------------------
           é«˜çº§æŒ‰é’®æ ·å¼ - ä¿®æ”¹ä¸ºæ©™è‰²ç³»
           ----------------------- */
        .snap-btn {
            /* ä¿®æ”¹ï¼šæ”¹ä¸ºæ©™è‰²/æ·±æ£•è‰²æ¸å˜ */
            background: linear-gradient(135deg, #c2410c 0%, #7c2d12 100%);
            color: white;
            border: 2px solid #9a3412;
            box-shadow: 
                0 4px 6px -1px rgba(124, 45, 18, 0.2), 
                0 2px 4px -1px rgba(124, 45, 18, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .snap-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 10px 15px -3px rgba(124, 45, 18, 0.3), 
                0 4px 6px -2px rgba(124, 45, 18, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: #ea580c;
        }

        .snap-btn:active {
            transform: translateY(1px);
        }

        .snap-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* é—ªå…‰æ•ˆæœè£…é¥° */
        .snap-btn::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
            transform: skewX(-25deg);
            transition: 0.5s;
        }
        
        .snap-btn:hover::after {
            left: 200%;
            transition: 0.7s ease-in-out;
        }

    </style>
</head>
<body>

    <!-- å·¦ä¾§ï¼šè¾“å…¥æ§åˆ¶åŒº (ä¿®æ”¹èƒŒæ™¯è‰²) -->
    <div class="w-[400px] input-sidebar border-r border-[#854d0e] flex flex-col h-full z-20 shadow-2xl flex-shrink-0">
        <!-- ä¿®æ”¹ï¼šèƒŒæ™¯è‰²æ”¹ä¸º vintage-brown -->
        <div class="p-8 bg-vintage-brown text-white relative overflow-hidden">
            <div class="absolute -right-4 -top-4 w-28 h-28 bg-classic-gold rounded-full opacity-20 blur-xl"></div>
            <h1 class="text-3xl font-bold font-serif-sc tracking-widest relative z-10">æ–‡æ‰‹å¹´åº¦æ€»ç»“</h1>
            <p class="text-sm text-[#fdba74] mt-2 font-serif-sc relative z-10 opacity-80 italic">Surprise Polaroid Edition</p>
        </div>
        
        <div class="flex-1 overflow-y-auto p-8 space-y-8">
            <div class="group">
                <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Select Month</label>
                <div class="relative">
                    <select id="monthSelect" onchange="handleMonthChange()" class="w-full p-3 pl-4 border border-[#d4cbbd] rounded-lg shadow-sm focus:ring-2 focus:ring-classic-gold focus:border-classic-gold bg-[#fdfbf7] text-slate-700 appearance-none font-serif-sc font-bold text-lg">
                        <option value="1">ä¸€æœˆ (January)</option>
                        <option value="2">äºŒæœˆ (February)</option>
                        <option value="3">ä¸‰æœˆ (March)</option>
                        <option value="4">å››æœˆ (April)</option>
                        <option value="5">äº”æœˆ (May)</option>
                        <option value="6">å…­æœˆ (June)</option>
                        <option value="7">ä¸ƒæœˆ (July)</option>
                        <option value="8">å…«æœˆ (August)</option>
                        <option value="9">ä¹æœˆ (September)</option>
                        <option value="10">åæœˆ (October)</option>
                        <option value="11">åä¸€æœˆ (November)</option>
                        <option value="12">åäºŒæœˆ (December)</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-slate-500">
                        <svg class="h-5 w-5 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥æ¡†èƒŒæ™¯ -->
            <div id="januaryOnlyFields" class="space-y-4 bg-[#fdfbf7]/60 p-5 rounded-xl border border-[#d4cbbd] relative overflow-hidden shadow-inner">
                <div class="absolute top-0 left-0 w-1.5 h-full bg-classic-gold"></div>
                <div class="text-xs text-classic-gold font-bold uppercase tracking-wider mb-2 flex items-center gap-2">
                    <span>âœ¨ Annual Settings</span>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-1">å¹´åº¦æ ‡é¢˜</label>
                    <input type="text" id="inputMainTitle" value="æ–‡æ‰‹å¹´åº¦æ€»ç»“" 
                           class="w-full p-2 border-b border-[#d4cbbd] bg-transparent focus:border-classic-gold focus:outline-none transition-colors text-base" oninput="updatePreview()">
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-1">å¡«è¡¨äºº</label>
                    <input type="text" id="inputFiller" placeholder="ä½ çš„ç¬”å" 
                           class="w-full p-2 border-b border-[#d4cbbd] bg-transparent focus:border-classic-gold focus:outline-none transition-colors text-base" oninput="updatePreview()">
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Content Input</label>
                    <div class="space-y-4">
                        <div>
                            <input type="text" id="inputWorkTitle" placeholder="æœ¬æœˆå†™ä½œæ ‡é¢˜" 
                                   class="w-full p-4 border border-[#d4cbbd] bg-[#fdfbf7] rounded-lg text-sm focus:ring-1 focus:ring-classic-gold focus:border-classic-gold shadow-sm transition-shadow hover:shadow-md" oninput="updatePreview()">
                        </div>
                        <div>
                            <input type="text" id="inputCP" placeholder="CPå" 
                                   class="w-full p-4 border border-[#d4cbbd] bg-[#fdfbf7] rounded-lg text-sm focus:ring-1 focus:ring-classic-gold focus:border-classic-gold shadow-sm transition-shadow hover:shadow-md" oninput="updatePreview()">
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-2">æœ€å–œæ¬¢çš„ç‰‡æ®µ</label>
                    <textarea id="inputSnippet" rows="6" placeholder="è¾“å…¥é‚£ä¸ªè®©ä½ å¿ƒåŠ¨çš„ç¬é—´..." 
                              class="w-full p-4 border border-[#d4cbbd] bg-[#fdfbf7] rounded-lg text-sm focus:ring-1 focus:ring-classic-gold focus:border-classic-gold leading-relaxed shadow-sm transition-shadow hover:shadow-md resize-none" oninput="updatePreview()"></textarea>
                </div>
                
                <div>
                    <label class="block text-xs font-medium text-slate-500 mb-2">Free Talk</label>
                    <textarea id="inputFreeTalk" rows="3" placeholder="æœ¬æœˆçš„ä¸€ç‚¹ç¢ç¢å¿µ..." 
                              class="w-full p-4 border border-[#d4cbbd] bg-[#fdfbf7] rounded-lg text-sm focus:ring-1 focus:ring-classic-gold focus:border-classic-gold shadow-sm transition-shadow hover:shadow-md" oninput="updatePreview()"></textarea>
                </div>
            </div>
        </div>

        <div class="p-6 border-t border-[#d4cbbd] bg-[#e3dcd1] z-10">
            <!-- æŒ‰é’®æ ·å¼å·²åœ¨ CSS ä¸­æ›´æ–° -->
            <button onclick="generateImage()" id="generateBtn" 
                    class="snap-btn w-full font-oswald font-bold py-4 px-4 rounded-xl flex items-center justify-center gap-3 text-2xl relative overflow-hidden">
                <span class="relative z-10">SNAP</span>
                <span class="text-sm relative z-10 opacity-70 font-normal normal-case ml-1 tracking-normal">ç”Ÿæˆæ‹ç«‹å¾—</span>
            </button>
            <p class="text-center text-xs text-slate-500 mt-3 font-serif-sc">ç›¸æœºä¼šè‡ªåŠ¨æ‹ç…§å¹¶è´´åˆ°ç™½æ¿ä¸Š</p>
        </div>
    </div>

    <!-- éšè—çš„æš—æˆ¿åŒºåŸŸ -->
    <div id="darkroom">
        <div id="capture-target">
            <div id="polaroidCard" class="polaroid-card">
                <div class="tape-main" id="renderTape"></div>

                <div id="januaryHeader" class="mb-5 relative">
                    <div class="absolute -top-6 -right-4 text-7xl font-playfair font-black text-slate-200 select-none z-0 opacity-80 rotate-12">2025</div>
                    <div class="relative z-10 text-center">
                        <!-- ä¿®æ”¹ï¼šæ·±è“è‰²æ–‡å­—æ”¹ä¸º vintage-brown -->
                        <h2 id="viewMainTitle" class="text-4xl font-serif-sc font-bold text-vintage-brown tracking-wider mb-3 mt-4">æ–‡æ‰‹å¹´åº¦æ€»ç»“</h2>
                        <div class="inline-flex flex-col items-center">
                            <div class="py-1 px-5 flex items-center gap-2">
                                <span class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">WRITTEN BY</span>
                                <!-- ä¿®æ”¹ï¼šæ–‡å­—é¢œè‰² -->
                                <span class="font-serif-sc font-bold text-vintage-brown text-sm" id="viewFiller">NAME</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-4 pb-2">
                    <div class="flex items-baseline gap-3">
                        <!-- ä¿®æ”¹ï¼šæ–‡å­—é¢œè‰² -->
                        <div class="text-4xl font-playfair font-black text-vintage-brown leading-none uppercase tracking-tight" id="viewMonthName">JAN</div>
                        <div class="h-6 w-[1px] bg-classic-gold rotate-12"></div>
                        <div class="text-lg font-serif-sc font-bold text-classic-gold leading-none" id="viewMonthCN">ä¸€æœˆ</div>
                    </div>
                    <div class="text-5xl font-playfair font-bold text-slate-100 select-none" id="viewMonthNum">01</div>
                </div>

                <div class="flex-1 flex flex-col gap-6 relative z-10">
                    <div class="flex flex-col gap-2 px-1">
                        <div class="flex items-baseline gap-2">
                            <span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded uppercase tracking-wider min-w-fit">Title</span>
                            <!-- ä¿®æ”¹ï¼šæ–‡å­—é¢œè‰² -->
                            <span class="text-lg font-serif-sc font-bold text-vintage-brown w-full leading-tight" id="viewWorkTitle">æ— é¢˜</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded uppercase tracking-wider min-w-fit">CP</span>
                            <!-- ä¿®æ”¹ï¼šæ–‡å­—é¢œè‰²ï¼Œä¿æŒå®‹ä½“ -->
                            <span class="bg-yellow-100 px-2 py-0.5 rounded text-sm font-bold text-vintage-brown font-serif-sc" id="viewCP">---</span>
                        </div>
                    </div>

                    <div class="relative paper-scrap p-4 rotate-1 bg-white transform transition-transform">
                        <div id="viewSnippet" class="font-serif-sc text-slate-700 text-sm leading-7 text-justify whitespace-pre-wrap">
                            ç­‰å¾…è¾“å…¥...
                        </div>
                    </div>

                    <div class="mt-auto pt-2">
                         <div class="relative paper-scrap p-3 bg-yellow-50 -rotate-1 transform transition-transform">
                             <div class="absolute -top-2.5 left-1/2 -translate-x-1/2 w-8 h-4 tape-gold -rotate-2 z-10"></div>
                             <div class="text-[10px] font-bold text-classic-gold uppercase tracking-wider mb-1">Free Talk</div>
                             <div id="viewFreeTalk" class="text-xs text-slate-600 leading-relaxed font-serif-sc relative z-10">
                                 ...
                             </div>
                         </div>
                    </div>
                </div>
                
                <div class="absolute bottom-3 right-6">
                    <span class="text-[10px] text-slate-300 font-playfair italic">Writer's Log</span>
                </div>
            </div>
        </div>
    </div>

    <!-- å³ä¾§ï¼šç™½æ¿å±•ç¤ºåŒº -->
    <div class="flex-1 cork-board flex flex-col h-full shadow-2xl relative z-10" id="boardExportArea">
        <div class="p-6 bg-[#e3dcd1]/90 backdrop-blur border-b border-[#d4cbbd] shadow-sm flex justify-between items-center z-[60] sticky top-0">
            <div class="flex items-center gap-3">
                <span class="w-3 h-3 rounded-full bg-classic-gold shadow-lg ring-2 ring-white"></span>
                <h3 class="font-bold text-vintage-brown text-xl font-serif-sc">æˆ‘çš„å¹´åº¦ç™½æ¿</h3>
            </div>
            <div class="flex items-center gap-3">
                <span class="text-sm font-bold text-white bg-classic-gold px-3 py-1.5 rounded-full shadow-md" id="countBadge">0 / 12</span>
                <!-- å¯¼å‡ºç™½æ¿æŒ‰é’®: ä¿®æ”¹é¢œè‰² -->
                <button onclick="exportFullBoard()" class="text-sm font-bold bg-vintage-brown text-white border border-[#431407] px-3 py-1.5 rounded-full shadow-md hover:bg-[#270b04] transition-colors flex items-center gap-2">
                    <span>ğŸ–¼ï¸</span> å¯¼å‡ºç™½æ¿é•¿å›¾
                </button>
                <button onclick="downloadAll()" id="downloadAllBtn" class="text-sm font-bold bg-white text-vintage-brown border border-[#d4cbbd] px-3 py-1.5 rounded-full shadow-md hover:bg-slate-50 transition-colors hidden">
                    ğŸ“¦ æ‰“åŒ…åŸå›¾ (ZIP)
                </button>
            </div>
        </div>
        
        <div id="galleryContainer" class="flex-1 overflow-y-auto p-12 pt-96 flex flex-wrap content-start gap-12 justify-center relative">
            
            <div class="camera-container" id="camera">
                <div class="camera-body">
                    <div class="viewfinder"></div>
                    <div class="flash" id="camFlash"></div>
                    <div class="rainbow-stripe"></div>
                    <div class="lens-outer">
                        <div class="lens-inner">
                            <div class="lens-reflection"></div>
                        </div>
                    </div>
                    <div class="slot"></div>
                    <div class="shutter-btn"></div>
                </div>
            </div>

            <div class="w-full flex flex-col items-center justify-center mt-12 text-slate-500 opacity-40 select-none pointer-events-none" id="emptyState">
                <div class="text-7xl mb-4 grayscale animate-pulse">ğŸ“·</div>
                <p class="text-lg font-serif-sc">åœ¨å·¦ä¾§è¾“å…¥ï¼Œç‚¹å‡» SNAP<br>å¡«æ»¡è¿™é¢å¢™</p>
            </div>
        </div>
    </div>

    <script>
        const monthData = [
            { num: '01', name: 'JAN', cn: 'ä¸€æœˆ' }, { num: '02', name: 'FEB', cn: 'äºŒæœˆ' },
            { num: '03', name: 'MAR', cn: 'ä¸‰æœˆ' }, { num: '04', name: 'APR', cn: 'å››æœˆ' },
            { num: '05', name: 'MAY', cn: 'äº”æœˆ' }, { num: '06', name: 'JUN', cn: 'å…­æœˆ' },
            { num: '07', name: 'JUL', cn: 'ä¸ƒæœˆ' }, { num: '08', name: 'AUG', cn: 'å…«æœˆ' },
            { num: '09', name: 'SEP', cn: 'ä¹æœˆ' }, { num: '10', name: 'OCT', cn: 'åæœˆ' },
            { num: '11', name: 'NOV', cn: 'åä¸€æœˆ' }, { num: '12', name: 'DEC', cn: 'åäºŒæœˆ' }
        ];

        // å­˜å‚¨å¹²å‡€çš„å›¾ç‰‡æ•°æ® (æ— èƒ¶å¸¦)
        const generatedPhotos = {}; 
        let isGenerating = false;

        window.onload = function() {
            handleMonthChange();
            updatePreview();
        };

        function handleMonthChange() {
            const select = document.getElementById('monthSelect');
            const monthIndex = parseInt(select.value) - 1;
            const data = monthData[monthIndex];

            const janFields = document.getElementById('januaryOnlyFields');
            const janHeader = document.getElementById('januaryHeader');
            
            if (data.num === '01') {
                janFields.classList.remove('hidden');
                janHeader.style.display = 'block';
            } else {
                janFields.classList.add('hidden');
                janHeader.style.display = 'none';
            }

            document.getElementById('viewMonthNum').textContent = data.num;
            document.getElementById('viewMonthName').textContent = data.name;
            document.getElementById('viewMonthCN').textContent = data.cn;

            updatePreview();
        }

        function updatePreview() {
            const mainTitle = document.getElementById('inputMainTitle').value || 'æ–‡æ‰‹å¹´åº¦æ€»ç»“';
            const filler = document.getElementById('inputFiller').value || '---';
            const workTitle = document.getElementById('inputWorkTitle').value || 'æ— é¢˜';
            const cp = document.getElementById('inputCP').value || '---';
            const snippet = document.getElementById('inputSnippet').value || 'ï¼ˆç­‰å¾…ç”Ÿæˆ...ï¼‰';
            const freeTalk = document.getElementById('inputFreeTalk').value || '...';

            document.getElementById('viewMainTitle').textContent = mainTitle;
            document.getElementById('viewFiller').textContent = filler.toUpperCase();
            document.getElementById('viewWorkTitle').textContent = workTitle;
            document.getElementById('viewCP').textContent = cp;
            document.getElementById('viewSnippet').textContent = snippet;
            document.getElementById('viewFreeTalk').textContent = freeTalk;
        }

        function generateImage() {
            if (isGenerating) return;
            isGenerating = true;

            const monthVal = parseInt(document.getElementById('monthSelect').value);
            const target = document.getElementById('capture-target');
            const gallery = document.getElementById('galleryContainer');
            const btn = document.getElementById('generateBtn');
            const camFlash = document.getElementById('camFlash');
            
            const renderTape = document.getElementById('renderTape');
            renderTape.style.display = 'none';

            btn.disabled = true;
            btn.classList.add('opacity-75');

            camFlash.classList.add('firing');
            setTimeout(() => camFlash.classList.remove('firing'), 200);

            setTimeout(() => {
                html2canvas(target, {
                    scale: 6,
                    backgroundColor: null, 
                    logging: false,
                    useCORS: true,
                    onclone: (clonedDoc) => {
                        const clonedCard = clonedDoc.querySelector('.polaroid-card');
                        if(clonedCard) clonedCard.style.boxShadow = 'none';
                    }
                }).then(canvas => {
                    renderTape.style.display = 'block';

                    document.getElementById('emptyState').style.display = 'none';

                    const imgData = canvas.toDataURL('image/png');
                    generatedPhotos[monthVal] = imgData;

                    const flyingImg = document.createElement('img');
                    flyingImg.src = imgData;
                    flyingImg.className = 'flying-photo';
                    
                    const cameraEl = document.getElementById('camera');
                    const camRect = cameraEl.getBoundingClientRect();

                    const startTop = camRect.bottom - 20; 
                    const startLeft = camRect.left + (camRect.width / 2) - 100;

                    flyingImg.style.top = `${startTop}px`;
                    flyingImg.style.left = `${startLeft}px`;
                    flyingImg.style.transform = 'scale(0.8)';
                    
                    document.body.appendChild(flyingImg);

                    void flyingImg.offsetWidth;
                    flyingImg.style.transition = 'top 1.5s ease-out';
                    flyingImg.style.top = `${startTop + 200}px`;

                    setTimeout(() => {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'placeholder-item';
                        
                        const existingItem = document.getElementById(`wrapper-month-${monthVal}`);
                        let targetRect;
                        
                        if (existingItem) {
                            targetRect = existingItem.getBoundingClientRect();
                        } else {
                            gallery.appendChild(placeholder);
                            gallery.scrollTop = gallery.scrollHeight;
                            targetRect = placeholder.getBoundingClientRect();
                        }

                        flyingImg.style.transition = 'all 1.0s cubic-bezier(0.25, 1, 0.5, 1)';
                        flyingImg.style.top = `${targetRect.top}px`;
                        flyingImg.style.left = `${targetRect.left}px`;
                        flyingImg.style.width = `${targetRect.width}px`;
                        
                        const randomRotate = Math.random() * 6 - 3;
                        flyingImg.style.transform = `scale(1) rotate(${randomRotate}deg)`;

                        setTimeout(() => {
                            const wrapper = document.createElement('div');
                            wrapper.className = 'gallery-wrapper';
                            wrapper.id = `wrapper-month-${monthVal}`;
                            wrapper.style.transform = `rotate(${randomRotate}deg)`;

                            const tape = document.createElement('div');
                            tape.className = 'tape-on-board';
                            
                            const img = new Image();
                            img.src = imgData;
                            img.className = 'gallery-image';
                            
                            const dlBtn = document.createElement('button');
                            dlBtn.className = 'download-btn-single';
                            dlBtn.innerHTML = 'â¬‡';
                            dlBtn.title = 'ä¸‹è½½åŸå›¾ (æ— èƒ¶å¸¦)';
                            dlBtn.onclick = (e) => {
                                e.stopPropagation();
                                downloadSingle(monthVal);
                            };

                            wrapper.appendChild(tape);
                            wrapper.appendChild(img);
                            wrapper.appendChild(dlBtn);

                            if (existingItem) {
                                gallery.replaceChild(wrapper, existingItem);
                            } else {
                                gallery.replaceChild(wrapper, placeholder);
                            }

                            flyingImg.remove();
                            
                            updateCount();
                            isGenerating = false;
                            btn.disabled = false;
                            btn.classList.remove('opacity-75');

                        }, 1000); 

                    }, 1600); 

                });
            }, 100); 
        }

        function updateCount() {
            const count = Object.keys(generatedPhotos).length;
            document.getElementById('countBadge').textContent = `${count} / 12`;
            
            const dlAllBtn = document.getElementById('downloadAllBtn');
            if (count > 0) {
                dlAllBtn.classList.remove('hidden');
            }
        }

        function downloadSingle(monthVal) {
            const dataUrl = generatedPhotos[monthVal];
            if (!dataUrl) return;
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = `Summary2025_${monthData[monthVal-1].name}.png`;
            link.click();
        }

        function downloadAll() {
            const zip = new JSZip();
            const keys = Object.keys(generatedPhotos);
            
            if (keys.length === 0) return;

            keys.forEach(key => {
                const monthIdx = parseInt(key);
                const dataUrl = generatedPhotos[monthIdx];
                const base64Data = dataUrl.replace(/^data:image\/(png|jpg);base64,/, "");
                const fileName = `Summary2025_${monthData[monthIdx-1].name}.png`;
                zip.file(fileName, base64Data, {base64: true});
            });

            zip.generateAsync({type:"blob"})
            .then(function(content) {
                saveAs(content, "WriterSummary2025_Polaroids.zip");
            });
        }

        // å¯¼å‡ºæ•´ä¸ªç™½æ¿é•¿å›¾
        function exportFullBoard() {
            const gallery = document.getElementById('galleryContainer');
            // è·å–å¡«è¡¨äººåå­—
            const fillerName = document.getElementById('inputFiller').value || 'Writer';
            
            // è·å–çœŸå®æ»šåŠ¨é«˜åº¦
            const fullHeight = gallery.scrollHeight;
            const fullWidth = gallery.scrollWidth;

            html2canvas(gallery, {
                height: fullHeight,
                width: fullWidth,
                windowHeight: fullHeight,
                scale: 8, // æå‡åˆ°8å€æ¸…æ™°åº¦
                useCORS: true,
                backgroundColor: '#e3dcd1', // ç¡®ä¿èƒŒæ™¯è‰²æ­£ç¡®
                onclone: (clonedDoc) => {
                    // ç¡®ä¿å…‹éš†å‡ºçš„å®¹å™¨æ˜¯å±•å¼€çš„
                    const clonedGallery = clonedDoc.getElementById('galleryContainer');
                    clonedGallery.style.height = fullHeight + 'px';
                    clonedGallery.style.overflow = 'visible';
                    // ç¡®ä¿ç›¸æœºä¹Ÿåœ¨
                    const clonedCamera = clonedDoc.getElementById('camera');
                    clonedCamera.style.position = 'absolute'; 

                    // åˆ›å»ºæ ‡é¢˜å®¹å™¨
                    const headerGroup = clonedDoc.createElement('div');
                    headerGroup.style.position = 'absolute';
                    headerGroup.style.width = '100%';
                    headerGroup.style.textAlign = 'center';
                    headerGroup.style.top = '240px'; 
                    headerGroup.style.zIndex = '40';
                    headerGroup.style.display = 'flex';
                    headerGroup.style.flexDirection = 'column';
                    headerGroup.style.alignItems = 'center';
                    headerGroup.style.gap = '8px';

                    // 1. ä¸»æ ‡é¢˜ - é¢œè‰²æ”¹ä¸º vintage-brown
                    const title = clonedDoc.createElement('div');
                    title.innerText = 'æˆ‘çš„å¹´åº¦æ€»ç»“ç™½æ¿';
                    title.style.fontFamily = '"Noto Serif SC", serif';
                    title.style.fontSize = '48px';
                    title.style.fontWeight = '900'; 
                    title.style.color = '#431407'; // vintage-brown
                    
                    // 2. å¡«è¡¨äººä¿¡æ¯
                    const subtitle = clonedDoc.createElement('div');
                    subtitle.innerHTML = `<span style="font-family: 'Playfair Display', serif; font-style: italic; color: #7c2d12; font-size: 18px; margin-right: 8px;">Written by</span><span style="font-family: 'Noto Serif SC', serif; font-weight: bold; color: #d97706; font-size: 24px;">${fillerName}</span>`;

                    headerGroup.appendChild(title);
                    headerGroup.appendChild(subtitle);
                    clonedGallery.appendChild(headerGroup);
                }
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    saveAs(blob, "My2025_Writer_Board.png");
                });
            });
        }
    </script>
</body>
</html>
